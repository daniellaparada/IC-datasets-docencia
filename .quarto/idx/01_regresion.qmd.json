{"title":"Regresión","markdown":{"headingText":"Regresión","containsRefs":false,"markdown":"Presentamos un ejemplo de modelos de regresión a partir de datos reales de temperatura y uso del sistema de bicicletas Ecobici de la Ciudad Autónoma de Buenos Aires.\n\n![Cómo *MidJourney* imagina que se ilustra este problema bajo el *prompt*: */imagine an enchanting illustration of Buenos Aires, with the obelisk at the center of the image, and colorful weather elements interacting with a road and a bicycle path*.](./fuente/01_regresion/apertura.png){fig-align=\"center\"}\n\n\nA continuación, se muestran algunos posibles ajustes de regresión que vinculan la cantidad de usuarios del sistema Ecobici por día en función de la temperatura, distinguiendo por usos en días de semana o fin de semana.\n\n```{r, message=FALSE, warning=FALSE}\n# Librerías necesarias\nrequire(tidyverse)\nrequire(ggfortify)\nrequire(plotly)\nrequire(kableExtra)\nrequire(knitr)\n```\n\n## Exploración inicial\n\nEn el *dataset* reducido `temp-bici.csv` se incluyen datos de viajes con duración entre 5 y 60 minutos, cualquier día de la semana, desde el 4 de junio de 2022 hasta el 3 de junio de 2023.\n\nEl *dataset* `temp-bici.csv` se encuentra [acá](https://github.com/daniellaparada/IC-datasets-docencia/blob/main/fuente/01_regresion/temp-bici.csv). A continuación se muestran 10 datos de dicho conjunto.\n\n```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}\noptions(scipen=999)\ndatos <- read_csv(\"./fuente/01_regresion/temp-bici.csv\")\n```\n\n```{r}\nknitr::kable(datos[1:10,], caption = \"Dataset reducido\")\n```\n\nComo puede verse en el siguiente gráfico, la cantidad de registros de viajes de esa duración varía en función de la temperatura máxima del día, y de si se trata de un día de la semana (lunes a viernes) o fin de semana (sábado y domingo).\n\n```{r, message=FALSE, warning=FALSE}\nggplotly(\n  ggplot(data = filter(datos), aes(\n    x = tmax,\n    y = n,\n    key = fecha,\n    col = tipo_dia\n  )) +\n    labs(x = \"Temperatura máxima\", y = \"Cantidad de usos de Ecobici\") +\n    geom_point() +\n    theme_classic(),\n  source = \"select\",\n  tooltip = c(\"key\")\n)\n```\n\nEn el gráfico se observa una tendencia similar en cuanto a cómo varía la cantidad de usos diarios del sistema en función de la temperatura máxima del día. Sin embargo, y aunque la tendencia es similar, la cantidad de usos se reduce notablemente los fines de semana.\n\nTales tendencias se mantienen, ya sea que se considere la temperatura media o la mínima, como se muestra en los siguientes gráficos; aunque se observa una tendencia ligeramente distinta para los fines de semana.\n\n```{r, message=FALSE, warning=FALSE}\nggplotly(\n  ggplot(data = filter(datos), aes(\n    x = tmed,\n    y = n,\n    key = fecha,\n    col = tipo_dia\n  )) +\n    labs(x = \"Temperatura media\", y = \"Cantidad de usos de Ecobici\") +\n    geom_point() +\n    theme_classic(),\n  source = \"select\",\n  tooltip = c(\"key\")\n)\n```\n\n```{r, message=FALSE, warning=FALSE}\nggplotly(\n  ggplot(data = filter(datos), aes(\n    x = tmin,\n    y = n,\n    key = fecha,\n    col = tipo_dia\n  )) +\n    labs(x = \"Temperatura mínima\", y = \"Cantidad de usos de Ecobici\") +\n    geom_point() +\n    theme_classic(),\n  source = \"select\",\n  tooltip = c(\"key\")\n)\n```\n\nEl sistema de Ecobici es un sistema público de transporte y, como tal, es razonable que su uso sea intensivo durante los días hábiles, lo que explica las tendencias separadas que se ven en los gráficos anteriores. Sin embargo, en el conjunto de datos no se tiene información de feriados, por lo que hay algunas observaciones del grupo verde (lunes a viernes) que se observan próximos a los del grupo rojo (fines de semana). El 1ro de mayo es una de ellas. También hay fines de semana que coinciden con feriados en los que típicamente hay menos movimiento, como ocurre con la observación roja que corresponde al 1ro de enero. Y también ocurre lo contrario: fines de semana de uso atípico, como el de aquel domingo 18 de diciembre de 2022 en que Argentina se coronó campeón Mundial, y cuya observación, aunque de color rojo (domingo), se ubica dentro de la nube de puntos verdes.\n\nEste *dataset* no cuenta con datos de precipitaciones para las fechas observadas, lo que podría ayudar a explicar las mermas en el uso del sistema de Ecobici de ciertas fechas \\[para más información sobre esto, puede consultarse el capítulo 3\\]. Sin embargo, es notable ver que existe cierta tendencia entre la intensidad del uso y la temperatura. Y tal tendencia no obedece únicamente a una cuestión de temporadas climáticas (estaciones del año, por ejemplo). Esto puede observarse en los siguientes gráficos, en donde se muestra que la evolución de la temperatura en función de la fecha del año no exhibe el mismo comportamiento que el uso del sistema Ecobici.\n\n```{r, message=FALSE, warning=FALSE}\nggplotly(\n  ggplot(data = filter(datos), aes(\n    x = fecha,\n    y = n,\n    key = tmax,\n    col = tipo_dia\n  )) +\n    labs(x = \"Fecha\", y = \"Cantidad de usos de Ecobici\") +\n    geom_point() +\n    theme_classic(),\n  source = \"select\",\n  tooltip = c(\"key\")\n)\n```\n\n```{r, message=FALSE, warning=FALSE}\nggplotly(\n  ggplot(data = filter(datos), aes(x = fecha, y = tmax)) +\n    labs(x = \"Fecha\", y = \"Temperatura máxima\") +\n    geom_point() +\n    theme_classic(),\n  source = \"select\",\n  tooltip = c(\"key\")\n)\n```\n\nEsto sugiere que un ajuste lineal podría no ser el más adecuado para modelar la relación entre estas variables. En la siguiente sección, se prueban ajustes lineales y cuadráticos para explicar el uso del sistema Ecobici en función de la temperatura máxima diaria, tanto para días de semana como para fines de semana.\n\n## Ajuste lineal\n\nEl ajuste lineal sobre el *dataset* completo muestra lo que anticipaban los gráficos anteriores. Aun cuando se ajusta por tipo de día, no se capta por completo la relación que se observa entre las variables a partir de los datos.\n\n```{r, message=FALSE, warning=FALSE}\nggplotly(\n  ggplot(data = filter(datos), aes(\n    x = tmax,\n    y = n,\n    color = tipo_dia,\n    key = fecha\n  )) +\n    labs(x = \"Temperatura máxima\", y = \"Cantidad de usos de Ecobici\") +\n    geom_point() +\n    geom_smooth(method = \"lm\") +\n    theme_classic(),\n  source = \"select\",\n  tooltip = c(\"key\")\n)\n```\n\n### Gráficos de diagnóstico\n\nLos gráficos de diagnóstico exhiben estructura en los residuos en ambos ajustes.\n\n#### **Día de semana**\n\n```{r, message=FALSE, warning=FALSE}\nautoplot(lm(n ~ tmax,\n            data = datos[datos$tipo_dia == \"Lunes a viernes\",]),\n         label.size = 3)\n```\n\nLas observaciones 122, 135 y 236 corresponden a los siguientes casos (todos feriados nacionales).\n\n```{r, echo=FALSE, message=FALSE, warning=FALSE}\na <- datos[datos$tipo_dia == \"Lunes a viernes\", ]\nknitr::kable(a[c(121, 135, 236), ])\n```\n\n#### **Fin de semana**\n\n```{r, message=FALSE, warning=FALSE}\nautoplot(lm(n ~ tmax,\n            data = datos[datos$tipo_dia == \"Fin de semana\", ]),\n         label.size = 3)\n```\n\nLas observaciones 13, 42, 58 y 62 corresponden a los siguientes casos.\n\n```{r, echo=FALSE, message=FALSE, warning=FALSE}\na <- datos[datos$tipo_dia == \"Fin de semana\", ]\nknitr::kable(a[c(13, 42, 58, 62), ])\n```\n\n## Ajuste cuadrático\n\nEl ajuste cuadrático mejora el ajuste anterior y parece modelar mejor la estructura observada.\n\n```{r, message=FALSE, warning=FALSE}\nggplotly(\n  ggplot(data = filter(datos), aes(\n    x = tmax,\n    y = n,\n    color = tipo_dia,\n    key = fecha\n  )) +\n    labs(x = \"Temperatura máxima\", y = \"Cantidad de usos de Ecobici\") +\n    geom_point() +\n    geom_smooth(method = \"lm\",\n                formula = y ~ poly(x, 2)) +\n    theme_classic(),\n  source = \"select\",\n  tooltip = c(\"key\")\n)\n```\n\n### Gráficos de diagnóstico\n\nEn efecto, los gráficos de diagnóstico confirman que parte de la estructura de los residuos fue resuelta.\n\n#### **Día de semana**\n\n```{r, message=FALSE, warning=FALSE}\nautoplot(lm(n ~ poly(tmax, 2),\n            data = datos[datos$tipo_dia == \"Lunes a viernes\", ]),\n         label.size = 3)\n```\n\nLas observaciones 10, 121, 135, 220 y 236 corresponden a los siguientes casos (todos feriados nacionales).\n\n```{r, echo=FALSE, message=FALSE, warning=FALSE}\na <- datos[datos$tipo_dia == \"Lunes a viernes\", ]\nknitr::kable(a[c(10, 121, 135, 220, 236), ])\n```\n\n#### **Fin de semana**\n\n```{r, message=FALSE, warning=FALSE}\nautoplot(lm(n ~ poly(tmax, 2),\n            data = datos[datos$tipo_dia == \"Fin de semana\", ]),\n         label.size = 3)\n```\n\nLas observaciones 42, 58 y 62 corresponden a los siguientes casos.\n\n```{r, echo=FALSE, message=FALSE, warning=FALSE}\na <- datos[datos$tipo_dia == \"Fin de semana\", ]\nknitr::kable(a[c(42, 58, 62), ])\n```\n\n## Ajuste lineal para días templados\n\nEl ajuste podría ser lineal para explicar el uso del sistema Ecobici para días templados, por ejemplo, con temperaturas máximas inferiores a los 25°C.\n\n```{r, message=FALSE, warning=FALSE}\nggplotly(\n  ggplot(\n    data = filter(datos, tmax < 25),\n    aes(\n      x = tmax,\n      y = n,\n      color = tipo_dia,\n      key = fecha\n    )\n  ) +\n    labs(x = \"Temperatura máxima (menor que 25°C)\", y = \"Cantidad de usos de Ecobici\") +\n    geom_point() +\n    geom_smooth(method = \"lm\") +\n    theme_classic(),\n  source = \"select\",\n  tooltip = c(\"key\")\n)\n```\n\n### Gráficos de diagnóstico\n\nLos gráficos de diagnóstico exhiben menos estructura en los residuos respecto del ajuste lineal que cuando se consideraban todas las posibles temperaturas máximas. Es decir, parece razonable suponer que la tendencia en el uso del sistema Ecobici es creciente en relación con la temperatura máxima, siempre que esta no exceda cierto límite.\n\n#### **Día de semana**\n\n```{r, message=FALSE, warning=FALSE}\nautoplot(lm(n ~ tmax,\n            data = datos[(datos$tipo_dia == \"Lunes a viernes\" &\n                            datos$tmax < 25), ]),\n         label.size = 3)\n```\n\nLas observaciones 10, 110, 122 y 135 corresponden a los siguientes casos (todos feriados nacionales).\n\n```{r, echo=FALSE, message=FALSE, warning=FALSE}\na <- datos[(datos$tipo_dia == \"Lunes a viernes\" &\n              datos$tmax < 25), ]\nknitr::kable(a[c(10, 110, 122, 135), ])\n```\n\n#### **Fin de semana**\n\n```{r, message=FALSE, warning=FALSE}\nautoplot(lm(n ~ tmax,\n            data = datos[(datos$tipo_dia == \"Fin de semana\" &\n                            datos$tmax < 25), ]),\n         label.size = 3)\n```\n\nLas observaciones 42, 46 y 48 corresponden a los siguientes casos.\n\n```{r, echo=FALSE, message=FALSE, warning=FALSE}\na <- datos[(datos$tipo_dia == \"Fin de semana\" &\n              datos$tmax < 25), ]\nknitr::kable(a[c(42, 46, 48), ])\n```\n\n------------------------------------------------------------------------\n\n# Acerca de los datos\n\nA continuación, se detallan aspectos de los conjuntos de datos que conformaron el *dataset* reducido para el desarrollo del ejemplo, a la vez que se incluyen las fuentes de los datos y el código utilizado para pre-procesarlo con la sintaxis de `tidyverse`. De esta forma, puede fácilmente replicarse y/o adaptarse si así se lo desea.\n\nTambién se incluye el enlace de descarga al dataset reducido, `temp-bici.csv`, con el que se desarrolló el ejemplo.\n\n## Sobre el *dataset* de temperatura\n\nLos datos de este ejemplo corresponden a datos de temperatura de los últimos 365 días tomados del Servicio Meterológico Nacional [(disponibles acá)](https://ssl.smn.gob.ar/dpd/zipopendata.php?dato=regtemp). En particular, se considerarán los datos procesados de temperatura mínimas y máximas registradas en Aeroparque desde el 4 de junio de 2022 al 3 de junio de 2023.\n\n```{r, message=FALSE, warning=FALSE, eval=FALSE, echo=TRUE}\ntemperatura <-\n  read_table(\"./fuente/01_regresion/registro_temperatura365d_smn.txt\") %>%\n  slice(2:n()) %>%\n  filter(NOMBRE == \"AEROPARQUE\") %>%\n  select(1:3) %>%\n  mutate(\n    fecha = dmy(FECHA),\n    tmin = as.double(TMIN),\n    tmax = as.double(TMAX),\n    tmed = 0.5 * (tmin + tmax)\n  )\n```\n\n## Sobre el *dataset* de Ecobici\n\nLos datos de este ejemplo corresponden a datos de uso del sistema Ecobici de la Ciudad de Buenos Aires [(disponibles acá)](https://data.buenosaires.gob.ar/dataset/bicicletas-publicas). En particular, se considerarán los datos de los años 2022 y 2023 correspondientes a viajes de entre 5 minutos y 1 hora de duración.\n\nEcobici es el sistema de transporte público de bicicletas de la Ciudad de Buenos Aires, que tiene estaciones automáticas con bicicletas a disposición las 24 horas, todos los días del año. El sistema es gratuito para todas las personas residentes del país de lunes a viernes (días hábiles) con hasta cuatro viajes de 30 minutos cada uno. Sin embargo, si se utiliza por un tiempo mayor que el indicado o durante los fines de semana, existen diferentes pases con variados costos. A modo de referencia, el pase que habilita a hacer 6 viajes diarios de hasta 60 minutos cada uno cualquier día de la semana tiene un costo de \\$1.785 (junio 2023).\n\n```{r, message=FALSE, warning=FALSE, eval=FALSE, echo=TRUE}\ntrips_2022 <- read_csv(\n  \"./fuente/01_regresion/trips_2022.csv\",\n  col_types = cols(fecha_origen_recorrido = col_datetime(format = \"%Y-%m-%d %H:%M:%S\"))\n) %>%\n  mutate(fecha = format(as_date(ymd_hms(\n    fecha_destino_recorrido\n  )))) %>%\n  filter(duracion_recorrido > 300 && duracion_recorrido < 3600) %>%\n  group_by(fecha) %>%\n  count() %>%\n  mutate(fecha = as_date(fecha))\n\ntrips_2023 <- read_csv(\n  \"./fuente/01_regresion/trips_2023.csv\",\n  col_types = cols(fecha_origen_recorrido = col_datetime(format = \"%Y-%m-%d %H:%M:%S\"))\n) %>%\n  mutate(fecha = format(as_date(ymd_hms(\n    fecha_destino_recorrido\n  )))) %>%\n  filter(duracion_recorrido > 300 && duracion_recorrido < 3600) %>%\n  group_by(fecha) %>%\n  count() %>%\n  mutate(fecha = as_date(fecha))\n\ntrips <- rbind(trips_2022, trips_2023)\n```\n\n## *Dataset* pre-procesado: `temp-bici.csv`\n\nPara reducir los datos al estudio de interés, se crea un dataset conjunto, `temp-bici.csv`, a partir de los datos de temperatura y de uso del sistema Ecobici en el que se dispone de las siguientes variables.\n\n-   `fecha`: fecha, en el formato año-mes-día.\n-   `n`: cantidad de registros de uso del sistema EcoBici en la fecha indicada.\n-   `tmin`: temperatura mínima registrada en esa fecha.\n-   `tmax`: temperatura máxima registrada en esa fecha.\n-   `tmed`: temperatura media, construida como el promedio entre la temperatura mínima y máxima de esa fecha.\n-   `dia`: día de la semana de la fecha indicada.\n-   `tipo_dia`: tipo de día (Fin de semana o Lunes a viernes) de la fecha indicada.\n\n```{r, message=FALSE, warning=FALSE, eval=FALSE, echo=TRUE}\ntrips <- trips %>%\n  filter(fecha >= min(temperatura$fecha) &\n           fecha <= max(temperatura$fecha))\n\ndatos <-\n  left_join(trips, temperatura, by = c(\"fecha\" = \"fecha\")) %>%\n  drop_na() %>%\n  mutate(\n    dia = weekdays(fecha),\n    tipo_dia = ifelse(dia %in% c(\"sábado\", \"domingo\"), \"Fin de semana\", \"Lunes a viernes\")\n  ) %>%\n  select(c(1, 2, 6:10)) \n```\n\n# Librerías\n\nLas librerías usadas para el desarrollo de este ejemplo, así como la información de la sesión de `R`, se muestran en el código que sigue.\n\n```{r, message=FALSE, warning=FALSE, eval=FALSE, echo=TRUE}\nrequire(tidyverse)\nrequire(ggfortify)\nrequire(plotly)\nrequire(kableExtra)\nrequire(knitr)\n```\n\n```{r message=FALSE, warning=FALSE}\nsessionInfo()\n```\n\n# Referencias\n\n-   Servicio Meteorológico Nacional [(info disponible acá](https://www.smn.gob.ar/) y [datos disponibles acá.)](https://www.smn.gob.ar/descarga-de-datos)\n\n-   Sistema Ecobici de la Ciudad Autónoma de Buenos Aires [(info disponible acá](https://baecobici.com.ar/#/es/inicio) y [datos disponibles acá.)](https://data.buenosaires.gob.ar/dataset/bicicletas-publicas)\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":true,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"01_regresion.html"},"language":{"toc-title-document":"Tabla de contenidos","toc-title-website":"En esta página","related-formats-title":"Otros formatos","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Fuente","section-title-abstract":"Resumen","section-title-appendices":"Apéndices","section-title-footnotes":"Notas","section-title-references":"Referencias","section-title-reuse":"Reutilización","section-title-copyright":"Derechos de autor","section-title-citation":"Cómo citar","appendix-attribution-cite-as":"Por favor, cita este trabajo como:","appendix-attribution-bibtex":"BibTeX","title-block-author-single":"Autor/a","title-block-author-plural":"Autores/as","title-block-affiliation-single":"Afiliación","title-block-affiliation-plural":"Afiliaciones","title-block-published":"Fecha de publicación","title-block-modified":"Fecha de modificación","callout-tip-title":"Tip","callout-note-title":"Nota","callout-warning-title":"Advertencia","callout-important-title":"Importante","callout-caution-title":"Precaución","code-summary":"Código","code-tools-menu-caption":"Código","code-tools-show-all-code":"Mostrar todo el código","code-tools-hide-all-code":"Ocultar todo el código","code-tools-view-source":"Ver el código fuente","code-tools-source-code":"Ejecutar el código","code-line":"Línea","code-lines":"Líneas","copy-button-tooltip":"Copiar al portapapeles","copy-button-tooltip-success":"Copiado","repo-action-links-edit":"Editar esta página","repo-action-links-source":"Ver el código","repo-action-links-issue":"Informar de un problema","back-to-top":"Volver arriba","search-no-results-text":"Sin resultados","search-matching-documents-text":"documentos encontrados","search-copy-link-title":"Copiar el enlace en la búsqueda","search-hide-matches-text":"Ocultar resultados adicionales","search-more-match-text":"resultado adicional en este documento","search-more-matches-text":"resultados adicionales en este documento","search-clear-button-title":"Borrar","search-detached-cancel-button-title":"Cancelar","search-submit-button-title":"Enviar","search-label":"Buscar","toggle-section":"Alternar sección","toggle-sidebar":"Alternar barra lateral","toggle-dark-mode":"Alternar modo oscuro","toggle-reader-mode":"Alternar modo lector","toggle-navigation":"Navegación de palanca","crossref-fig-title":"Figura","crossref-tbl-title":"Tabla","crossref-lst-title":"Listado","crossref-thm-title":"Teorema","crossref-lem-title":"Lema","crossref-cor-title":"Corolario","crossref-prp-title":"Proposición","crossref-cnj-title":"Conjetura","crossref-def-title":"Definición","crossref-exm-title":"Ejemplo","crossref-exr-title":"Ejercicio","crossref-ch-prefix":"Capítulo","crossref-apx-prefix":"Apéndice","crossref-sec-prefix":"Sección","crossref-eq-prefix":"Ecuación","crossref-lof-title":"Listado de Figuras","crossref-lot-title":"Listado de Tablas","crossref-lol-title":"Listado de Listados","environment-proof-title":"Prueba","environment-remark-title":"Observación","environment-solution-title":"Solución","listing-page-order-by":"Ordenar por","listing-page-order-by-default":"Por defecto","listing-page-order-by-date-asc":"Menos reciente","listing-page-order-by-date-desc":"Más reciente","listing-page-order-by-number-desc":"De mayor a menor","listing-page-order-by-number-asc":"De menor a mayor","listing-page-field-date":"Fecha","listing-page-field-title":"Título","listing-page-field-description":"Descripción","listing-page-field-author":"Autor/a","listing-page-field-filename":"Nombre de archivo","listing-page-field-filemodified":"Fecha de modificación","listing-page-field-subtitle":"Subtítulo","listing-page-field-readingtime":"Tiempo de lectura","listing-page-field-categories":"Categorías","listing-page-minutes-compact":"{0} minutos","listing-page-category-all":"Todas","listing-page-no-matches":"No hay resultados"},"metadata":{"lang":"es","fig-responsive":true,"quarto-version":"1.3.433","bibliography":["references.bib"],"code-summary":"Ver código","editor":"visual","theme":"cosmo"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}